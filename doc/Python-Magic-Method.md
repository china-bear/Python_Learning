# 魔术方法

> 在Python中, 所有以双下划线__包起来的方法，统称为Magic Method（魔术方法），它是一种的特殊方法，普通方法需要调用，而魔术方法不需要调用就可以自动执行。


## 常用的魔术方法

1. 初始化方法__init__
> 触发机制：实例化对象之后立即触发
> 参数：至少有一个self，接收当前对象，其他参数根据需要进行定义
> 返回值：无
> 作用：初始化对象的成员

2. 构造方法__new__
> 触发时机： 实例化对象时自动触发（在__init__之前触发）
> 参数：至少一个cls 接收当前类，其他参数根据初始化方法参数决定
> 返回值：必须返回一个对象实例，没有返回值，则实例化对象的结果为None
> 作用：实例化对象
> 注意：实例化对象是Object类底层实现，其他类继承了Object的__new__才能够实现实例化对象。

3. 析构方法__del__
> 触发时机：当该类对象被销毁时，自动触发
> 参数：一个self，接受当前对象
> 返回值：无
> 作用：关闭或释放对象创建时资源
> 注意：del不一定会触发当前方法，只有当前对象没有任何变量引用时才会触发

4. __call__
> 调用对象的魔术方法
> 触发时机:将对象当作函数调用时触发,方式： 对象()
> 参数:至少一个self接收对象，其余根据调用时参数决定
> 返回值：根据情况而定
> 作用：可以将复杂的步骤进行合并操作，减少调用的步骤，方便使用
> 注意：无

```python
class People(object):
    # 创建对象
    def __new__(cls, *args, **kwargs):
        print("触发了构造方法")
        ret = super().__new__(cls) # 调用父类的__new__()方法创建对象
        return ret ## 将对象返
    # 实例化对象
    def __init__(self, name, age):
        self.name = name
        self.age = age
        print("初始化方法")
    #  删除对象
    #   del 对象名或者程序执行结束之后
    def __del__(self):
        print("析构方法，删除对象")


if __name__ == '__main__':
    p1 = People('bear', 16)
```

5.__len__
触发时机：使用len(对象) 的时候触发
参数：一个参数self
返回值：必须是一个整型
作用：可以设置为检测对象成员个数，但是也可以进行其他任意操作
注意：返回值必须必须是整数，否则语法报错，另外该要求是格式要求。
6.__str__
触发时机:使用print(对象)或者str(对象)的时候触发
参数：一个self接收对象
返回值：必须是字符串类型
作用：print（对象时）进行操作，得到字符串，通常用于快捷操作
注意：无
7.__repr__
触发时机:在使用repr(对象)的时候触发
参数：一个self接收对象
返回值：必须是字符串
作用：将对象转使用repr化为字符串时使用，也可以用于快捷操作
8.__bool__
触发时机: 使用bool(对象)的时候触发
参数：一个self接收对象
返回值：必须是布尔值
作用：根据实际情况决定，可以作为快捷方式使用
注意:仅适合于返回布尔值的操作
9.__format__
触发时机：使用字符串.format(对象)时候触发
参数：一个self接收对象，一个参数接收format的{}中的格式，例如:>5
返回值:必须是字符串
作用：设置对象可以作为format的参数，并且自定义对象格式化的规则
注意：无

## 与属性操作相关的魔术方法

1.__getattr__
触发时机：获取不存在的对象成员时触发
参数：一个是接收当前对象的self，一个是获取成员名称的字符串
返回值：必须有值
作用:为访问不存在的属性设置值
注意：getattribute无论何时都会在getattr之前触发，触发了getattribute就不会在触发getattr了
2.__setattr__
触发时机:设置对象成员值的时候触发
参数:1个当前对象的self,一个是要设置的成员名称字符串,一个是要设置的值
返回值:无 过程操作
作用:接管设置操作,可以在设置前之前进行判断验证等行为
注意:在当前方法中无法使用成员=值的方式直接设置成员，否则会无限递归，必须借助object的设置方法来完成

object.__setattr__（参数1，参数2，参数3）
3.__delattr__
触发时机：删除对象成员时触发
参数：一个当前对象的self
返回值：无
作用:可以在删除成员时进行验证。
4.__getattribute__
触发时机：使用对象成员时触发，无论成员是否存在
参数：1个接收当前对象self，一个是获取的成员的名称字符串
返回值：必须有
作用：在具有封装操作（私有化时），为程序开部分访问权限使用
5.__dir__
触发时机：dir（对象）的时候触发
参数:1个接收当前对象self
返回值：必须为序列类型（列表，元组，集合等，）
作用：可以自定义成员列表的返回值

## 比较运算相关魔术方法

__ lt__(self, other)：
定义小于号的行为：x < y 调用 x.lt(y)
__ le__(self, other)：
定义小于等于号的行为：x <= y 调用 x.le(y)
__ eq__(self, other) ：
定义等于号的行为：x == y 调用 x.eq(y)
__ ne__(self, other)：
定义不等号的行为：x != y 调用 x.ne(y)
__ gt__(self, other)：
定义大于号的行为：x > y 调用 x.**gt(y)
__ ge__(self, other) ：
定义大于等于号的行为：x >= y 调用 x.ge(y)


## 上下文管理相关魔术方法(with)
__enter__ 和 __exit__

__enter__(self)
    1. 定义当使用 with 语句时的初始化行为
    2. enter 的返回值被 with 语句的目标或者 as 后的名字绑定

__exit__(self, exctype, excvalue, traceback)
    1. 定义当一个代码块被执行或者终止后上下文管理器应该做什么
    2. 一般被用来处理异常，清除工作或者做一些代码块执行完毕之后的日常工作
    
[Python常用魔术方法](https://zhuanlan.zhihu.com/p/329962624)